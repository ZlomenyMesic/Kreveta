//
// Kreveta chess engine by ZlomenyMesic
// started 4-3-2025
//

using Kreveta.consts;

using System.Runtime.CompilerServices;

namespace Kreveta.evaluation;

internal static class EvalTables {

    // this method uses the value tables in EvalTables.cs, and is used to evaluate the position of a piece.
    // there are two tables - midgame and endgame, which is important, because different pieces should be
    // in different positions as the game progresses (e.g. a king in the midgame should be in the corner,
    // but should move towards the center in the endgame)
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal static unsafe short GetTableValue(byte type, Color col, byte sq, int pieceCount) {

        // we have to index the piece type and position correctly. white
        // pieces are straightforward, but black piece have to be mirrored
        short index = (short)(type * 64 + (col == Color.WHITE
            ? sq ^ 7 ^ 56 // flip the square to the opposite side
            : sq ^ 7));   // flip only the file

        // we grab both the midgame and endgame table values
        fixed (short* midgame = &Middlegame[0],
                      endgame = &Endgame[0]) {

            // a very rough attempt for tapering evaluation - instead of
            // just switching straight from midgame into endgame, the table
            // value of the piece is always somewhere in between, based on
            // the number of pieces left on the board.
            return (short)(*(midgame + index) * pieceCount        / 32
                         + *(endgame + index) * (32 - pieceCount) / 32);
        }
    }

    // rough estimate of piece values. used in MVV-LVA capture ordering
    // to determine good captures, and also in delta pruning to create
    // a safe margin using the captured piece
    internal static readonly short[] PieceValues = [108, 319, 330, 520, 924, 10000, -1];

#region MIDDLEGAME
    
#endregion
    
#region ENDGAME
    
    internal static readonly short[] Middlegame = [
        100,
      100,
      100,
      100,
      100,
      100,
      100,
      100,
      102,
      111,
      100,
      89,
      97,
      101,
      95,
      98,
      109,
      105,
      99,
      101,
      103,
      106,
      97,
      89,
      86,
      108,
      101,
      102,
      106,
      109,
      103,
      101,
      98,
      94,
      94,
      105,
      92,
      87,
      102,
      73,
      100,
      86,
      84,
      111,
      92,
      89,
      86,
      83,
      110,
      104,
      104,
      97,
      91,
      106,
      109,
      98,
      100,
      100,
      100,
      100,
      100,
      100,
      100,
      100,
      272,
      289,
      292,
      302,
      290,
      298,
      288,
      279,
      284,
      292,
      311,
      297,
      314,
      312,
      290,
      291,
      281,
      313,
      315,
      314,
      318,
      307,
      305,
      278,
      305,
      312,
      314,
      296,
      299,
      307,
      308,
      306,
      294,
      307,
      326,
      306,
      307,
      307,
      285,
      286,
      296,
      290,
      293,
      294,
      306,
      290,
      291,
      287,
      280,
      294,
      288,
      306,
      286,
      304,
      294,
      283,
      273,
      286,
      289,
      295,
      283,
      287,
      281,
      262,
      305,
      313,
      307,
      296,
      310,
      304,
      307,
      307,
      314,
      340,
      311,
      306,
      315,
      323,
      324,
      326,
      323,
      325,
      326,
      304,
      323,
      320,
      331,
      336,
      332,
      339,
      322,
      324,
      330,
      319,
      317,
      322,
      324,
      321,
      327,
      315,
      311,
      325,
      322,
      312,
      316,
      307,
      313,
      319,
      312,
      297,
      315,
      303,
      304,
      301,
      308,
      303,
      306,
      310,
      299,
      303,
      298,
      309,
      300,
      309,
      302,
      294,
      305,
      301,
      499,
      523,
      503,
      517,
      519,
      520,
      509,
      477,
      514,
      491,
      515,
      502,
      506,
      508,
      492,
      488,
      492,
      519,
      512,
      505,
      516,
      499,
      503,
      494,
      475,
      467,
      468,
      492,
      502,
      486,
      471,
      484,
      481,
      473,
      472,
      474,
      475,
      482,
      488,
      475,
      465,
      467,
      477,
      472,
      479,
      473,
      476,
      476,
      477,
      477,
      482,
      476,
      487,
      482,
      487,
      482,
      493,
      488,
      485,
      487,
      481,
      487,
      498,
      495,
      896,
      907,
      925,
      918,
      909,
      923,
      896,
      891,
      904,
      894,
      913,
      927,
      920,
      903,
      912,
      902,
      911,
      917,
      897,
      916,
      915,
      907,
      906,
      901,
      909,
      905,
      900,
      897,
      905,
      894,
      898,
      911,
      909,
      905,
      893,
      892,
      893,
      890,
      889,
      907,
      935,
      936,
      904,
      894,
      891,
      910,
      911,
      899,
      894,
      906,
      917,
      918,
      914,
      910,
      899,
      911,
      895,
      898,
      894,
      906,
      907,
      901,
      904,
      908,
      42,
      51,
      32,
      17,
      9,
      23,
      49,
      25,
      17,
      -7,
      -7,
      -13,
      -13,
      -10,
      7,
      -4,
      -5,
      -3,
      -9,
      -27,
      -31,
      -27,
      -15,
      -3,
      -37,
      -23,
      -25,
      -40,
      -47,
      -32,
      -28,
      -38,
      -48,
      -32,
      -42,
      -64,
      -68,
      -48,
      -30,
      -50,
      -20,
      -20,
      -56,
      -73,
      -74,
      -62,
      -26,
      -17,
      -17,
      -19,
      -29,
      -71,
      -74,
      -29,
      -19,
      -14,
      -7,
      -17,
      -15,
      -29,
      -34,
      -19,
      -16,
      -15
    ];
    internal static readonly short[] Endgame = [
        100,
      100,
      100,
      100,
      100,
      100,
      100,
      100,
      53,
      75,
      73,
      71,
      72,
      91,
      60,
      70,
      71,
      100,
      88,
      69,
      72,
      82,
      80,
      69,
      102,
      110,
      107,
      79,
      79,
      90,
      111,
      109,
      126,
      108,
      116,
      92,
      109,
      95,
      127,
      105,
      170,
      153,
      134,
      145,
      132,
      137,
      146,
      149,
      216,
      206,
      207,
      191,
      186,
      210,
      213,
      198,
      100,
      100,
      100,
      100,
      100,
      100,
      100,
      100,
      226,
      221,
      241,
      252,
      246,
      239,
      224,
      234,
      230,
      245,
      255,
      236,
      246,
      254,
      231,
      233,
      236,
      245,
      259,
      266,
      266,
      251,
      251,
      233,
      248,
      271,
      274,
      288,
      286,
      282,
      272,
      239,
      239,
      271,
      291,
      278,
      286,
      271,
      264,
      236,
      244,
      252,
      264,
      279,
      273,
      255,
      245,
      243,
      239,
      252,
      251,
      263,
      244,
      253,
      253,
      243,
      242,
      250,
      243,
      248,
      242,
      245,
      249,
      230,
      283,
      289,
      286,
      278,
      296,
      277,
      275,
      283,
      285,
      292,
      283,
      285,
      298,
      281,
      279,
      277,
      283,
      272,
      281,
      298,
      308,
      287,
      282,
      303,
      284,
      290,
      296,
      277,
      299,
      288,
      277,
      261,
      284,
      272,
      288,
      290,
      297,
      302,
      293,
      274,
      283,
      274,
      274,
      296,
      284,
      268,
      293,
      268,
      279,
      278,
      277,
      281,
      272,
      278,
      272,
      270,
      285,
      281,
      283,
      293,
      289,
      272,
      285,
      272,
      497,
      524,
      490,
      491,
      493,
      504,
      508,
      487,
      509,
      506,
      508,
      503,
      494,
      514,
      503,
      489,
      515,
      519,
      512,
      511,
      505,
      514,
      508,
      516,
      489,
      505,
      494,
      496,
      497,
      516,
      501,
      498,
      496,
      510,
      498,
      501,
      489,
      513,
      512,
      510,
      495,
      503,
      503,
      500,
      500,
      502,
      509,
      509,
      492,
      497,
      511,
      506,
      513,
      508,
      520,
      500,
      491,
      503,
      496,
      499,
      494,
      508,
      506,
      491,
      899,
      914,
      908,
      901,
      896,
      914,
      909,
      902,
      901,
      898,
      916,
      899,
      919,
      911,
      918,
      901,
      907,
      917,
      914,
      929,
      911,
      909,
      900,
      915,
      917,
      922,
      931,
      922,
      934,
      924,
      915,
      909,
      909,
      913,
      916,
      923,
      930,
      910,
      911,
      912,
      918,
      919,
      906,
      918,
      913,
      916,
      913,
      917,
      907,
      900,
      918,
      916,
      914,
      904,
      903,
      909,
      891,
      906,
      894,
      900,
      918,
      901,
      911,
      905,
      -55,
      -39,
      -6,
      -12,
      -18,
      -19,
      -42,
      -69,
      -36,
      -12,
      3,
      20,
      9,
      -8,
      -22,
      -34,
      -19,
      -7,
      9,
      1,
      8,
      -16,
      -10,
      -7,
      -6,
      3,
      14,
      26,
      12,
      -6,
      4,
      -3,
      -17,
      7,
      11,
      25,
      14,
      -4,
      -8,
      -21,
      -21,
      -7,
      4,
      6,
      -5,
      -2,
      -24,
      -16,
      -31,
      -17,
      -18,
      5,
      -11,
      -4,
      -22,
      -29,
      -74,
      -47,
      -21,
      -9,
      -8,
      -17,
      -30,
      -67
    ];

#endregion
}
