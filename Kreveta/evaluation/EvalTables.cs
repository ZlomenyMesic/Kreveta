//
// Kreveta chess engine by ZlomenyMesic
// started 4-3-2025
//

using Kreveta.consts;

using System.Runtime.CompilerServices;

namespace Kreveta.evaluation;

internal static class EvalTables {

    // this method uses the value tables in EvalTables.cs, and is used to evaluate the position of a piece.
    // there are two tables - midgame and endgame, which is important, because different pieces should be
    // in different positions as the game progresses (e.g. a king in the midgame should be in the corner,
    // but should move towards the center in the endgame)
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal static unsafe short GetTableValue(byte type, Color col, byte sq, int pieceCount) {

        // we have to index the piece type and position correctly. white
        // pieces are straightforward, but black piece have to be mirrored
        short index = (short)(type * 64 + (col == Color.WHITE
            ? sq ^ 7 ^ 56 // flip the square to the opposite side
            : sq ^ 7));   // flip only the file

        // we grab both the midgame and endgame table values
        fixed (short* midgame = &Middlegame[0],
                      endgame = &Endgame[0]) {

            // a very rough attempt for tapering evaluation - instead of
            // just switching straight from midgame into endgame, the table
            // value of the piece is always somewhere in between, based on
            // the number of pieces left on the board.
            return (short)(*(midgame + index) * pieceCount        / 32
                         + *(endgame + index) * (32 - pieceCount) / 32);
        }
    }

    // rough estimate of piece values. used in MVV-LVA capture ordering
    // to determine good captures, and also in delta pruning to create
    // a safe margin using the captured piece
    internal static readonly short[] PieceValues = [108, 319, 330, 520, 924, 10000, -1];

#region MIDDLEGAME
    internal static readonly short[] Middlegame = 
    [
     100,  100,  100,  100,  100,  100,  100,  100,
      96,  105,   95,   89,   97,   95,   90,   92,
     107,  100,  104,   95,  108,  109,   90,   93,
      91,  102,  102,  104,  100,  106,   96,   96,
      92,   95,   88,  101,   87,   82,   96,   70,
      94,   80,   78,  103,   86,   83,   81,   77,
     105,   98,   99,   92,   86,   98,  103,   92,
     100,  100,  100,  100,  100,  100,  100,  100,
     
     278,  295,  297,  302,  295,  304,  293,  284,
     289,  297,  317,  303,  309,  312,  295,  296,
     287,  313,  309,  309,  312,  304,  310,  283,
     305,  305,  308,  291,  293,  302,  302,  301,
     299,  312,  320,  300,  301,  302,  291,  280,
     290,  284,  288,  289,  302,  286,  284,  281,
     275,  290,  282,  302,  280,  300,  288,  278,
     269,  282,  283,  288,  277,  281,  275,  256,
     
     298,  319,  311,  302,  316,  304,  313,  313,
     309,  336,  317,  312,  315,  323,  323,  326,
     329,  328,  321,  309,  318,  315,  327,  330,
     328,  333,  316,  318,  325,  312,  313,  316,
     319,  317,  321,  309,  306,  319,  318,  307,
     311,  301,  307,  313,  306,  292,  309,  297,
     297,  295,  303,  298,  301,  304,  294,  297,
     292,  303,  296,  304,  297,  289,  302,  296,
     
     503,  530,  496,  509,  513,  514,  502,  481,
     509,  495,  509,  496,  503,  504,  492,  491,
     497,  525,  506,  499,  509,  494,  509,  489,
     480,  472,  475,  484,  498,  480,  471,  489,
     477,  468,  467,  469,  470,  478,  482,  468,
     459,  462,  471,  467,  474,  467,  470,  470,
     471,  471,  477,  470,  481,  477,  481,  477,
     487,  483,  479,  483,  475,  482,  493,  489,
     
     901,  911,  920,  923,  904,  917,  901,  897,
     899,  900,  919,  920,  915,  910,  907,  895,
     917,  923,  901,  911,  911,  899,  912,  906,
     915,  911,  904,  891,  899,  888,  891,  918,
     914,  899,  887,  888,  887,  884,  885,  901,
     941,  930,  898,  889,  884,  905,  907,  894,
     889,  903,  911,  913,  909,  903,  896,  906,
     888,  892,  888,  900,  902,  895,  898,  902,
     
      48,   45,   37,   23,   14,   18,   43,   31,
      23,   -1,    0,   -7,   -8,   -4,   12,    1,
       0,    4,   -4,  -21,  -25,  -21,  -10,    3,
     -44,  -14,  -30,  -46,  -52,  -26,  -21,  -32,
     -55,  -39,  -47,  -72,  -73,  -55,  -35,  -54,
     -27,  -26,  -63,  -79,  -80,  -66,  -32,  -10,
     -23,  -25,  -33,  -77,  -78,  -35,  -15,   -8,
      -7,  -15,  -23,  -37,  -39,  -12,  -11,   -8,
    ];
#endregion
    
#region ENDGAME
    internal static readonly short[] Endgame = 
    [
     100,  100,  100,  100,  100,  100,  100,  100,
      48,   70,   67,   64,   65,   85,   54,   64,
      65,   94,   81,   63,   67,   77,   74,   71,
      97,  105,  101,   73,   73,   84,  106,  104,
     120,  103,  110,   86,  101,   88,  121,   99,
     165,  147,  127,  139,  125,  131,  142,  144,
     210,  202,  202,  185,  180,  204,  209,  192,
     100,  100,  100,  100,  100,  100,  100,  100,
     
     232,  223,  246,  252,  253,  245,  224,  240,
     235,  245,  259,  242,  239,  249,  236,  237,
     242,  241,  252,  260,  261,  245,  258,  241,
     243,  267,  268,  283,  281,  275,  266,  235,
     235,  272,  285,  274,  279,  267,  258,  230,
     239,  245,  258,  274,  268,  249,  239,  237,
     232,  246,  243,  258,  240,  247,  248,  237,
     237,  246,  238,  243,  237,  240,  243,  225,
     
     277,  294,  283,  284,  291,  270,  269,  289,
     280,  286,  290,  285,  292,  275,  275,  269,
     278,  275,  275,  304,  302,  281,  277,  296,
     278,  284,  291,  271,  294,  282,  272,  256,
     278,  267,  282,  284,  292,  298,  289,  269,
     276,  267,  269,  291,  277,  263,  289,  263,
     273,  274,  272,  277,  267,  271,  266,  265,
     281,  276,  277,  288,  283,  267,  280,  266,
     
     489,  518,  484,  486,  487,  498,  502,  483,
     504,  498,  503,  496,  489,  509,  498,  484,
     522,  513,  508,  506,  500,  509,  503,  511,
     482,  498,  489,  489,  489,  512,  496,  503,
     490,  505,  493,  494,  483,  508,  507,  504,
     489,  497,  498,  493,  494,  497,  504,  505,
     487,  492,  505,  501,  507,  502,  514,  493,
     486,  498,  490,  491,  488,  502,  502,  487,
     
     893,  908,  904,  905,  891,  907,  904,  896,
     896,  893,  909,  893,  913,  906,  914,  895,
     902,  912,  919,  922,  907,  904,  894,  908,
     912,  916,  926,  918,  929,  918,  909,  903,
     903,  908,  909,  916,  925,  904,  905,  905,
     914,  913,  900,  912,  908,  909,  908,  911,
     900,  894,  912,  910,  909,  899,  898,  904,
     885,  900,  888,  894,  913,  894,  906,  899,
     
     -49,  -44,    0,   -8,  -13,  -15,  -34,  -63,
     -34,   -6,    9,   26,   15,   -2,  -17,  -28,
     -14,   -2,   15,    1,   14,  -10,   -5,   -2,
     -11,   -3,    8,   20,    7,  -13,    9,    5,
     -23,    2,    8,   20,    9,  -10,  -14,  -15,
     -27,  -11,    0,    1,  -10,   -8,  -29,  -12,
     -37,  -25,  -24,   -2,  -16,  -11,  -18,  -23,
     -68,  -41,  -16,  -16,   -4,  -11,  -24,  -62,
    ];
#endregion
}